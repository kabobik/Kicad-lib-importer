# Техническое задание

## Разработка плагина/утилиты для импорта библиотек символов Altium Designer в KiCad

---

## 1. Цель работы

Разработать инструмент (далее — **Импортёр**), обеспечивающий **полный и корректный перенос всех символов** из библиотеки Altium Designer (`.SchLib`) в формат библиотек KiCad (`.kicad_sym`) с сохранением:

* графики символов,
* пинов и их свойств,
* многосекционной структуры,
* логических имен компонентов,

в обход штатного импортёра KiCad, который импортирует только один компонент.

---

## 2. Исходные данные

### 2.1 Входные данные

* Файлы библиотек Altium Designer:

  * `.SchLib` (бинарный формат)
* Образец(ы) библиотек для анализа:

  * предоставляются заказчиком
* Исходный код KiCad:

  * используется как справочный материал для:

    * структуры данных
    * формата `.kicad_sym`
    * правил валидности символов

---

### 2.2 Выходные данные

* Одна или несколько библиотек KiCad:

  * `.kicad_sym`
* Каждый компонент Altium должен быть:

  * преобразован в отдельный `symbol` KiCad
  * либо, при наличии частей, в `symbol` с несколькими `units`

---

## 3. Архитектура решения

### 3.1 Общая схема

```
Altium .SchLib
        ↓
  Парсер Altium
        ↓
 Нормализованная модель символов
        ↓
 Генератор .kicad_sym
        ↓
   KiCad (через плагин или вручную)
```

---

### 3.2 Компоненты системы

#### 3.2.1 Парсер Altium (`SchLib Parser`)

Функции:

* чтение бинарного `.SchLib`
* извлечение:

  * списка компонентов
  * графических примитивов
  * пинов
  * частей (Parts)
  * параметров

Требования:

* поддержка библиотек с несколькими компонентами
* отсутствие зависимости от версии GUI Altium
* обработка ошибок без аварийного завершения

---

#### 3.2.2 Внутренняя модель символа (Core Model)

Каждый компонент должен быть приведён к единой структуре:

```text
Symbol
 ├─ name
 ├─ reference
 ├─ units[]
 │   ├─ pins[]
 │   └─ graphics[]
 ├─ properties[]
 └─ metadata
```

Модель **не должна** повторять Altium 1:1.
Она должна соответствовать ограничениям KiCad.

---

#### 3.2.3 Модуль нормализации

Назначение:

* приведение Altium-структур к KiCad-совместимым

Обязанности:

* преобразование Parts → Units
* проверка уникальности номеров пинов
* устранение конфликтов:

  * одинаковые номера пинов
  * несовместимые типы
* удаление или игнорирование:

  * Altium-специфичных параметров
* формирование правил:

  * 1 компонент = 1 symbol
  * multipart = units одного symbol

---

#### 3.2.4 Генератор `.kicad_sym`

Функции:

* генерация текстового файла `.kicad_sym`
* соответствие формату KiCad 7/8/9
* генерация:

  * символов
  * units
  * пинов
  * графики
  * базовых свойств (`Reference`, `Value`, `Footprint`, `Datasheet`)

Требования:

* валидность для загрузки в Symbol Editor без ошибок
* читаемость и стабильность diff (Git-friendly)

---

#### 3.2.5 Плагин KiCad (опционально)

Тип:

* Python Action Plugin

Функции:

* выбор `.SchLib`
* запуск импорта
* добавление созданной библиотеки в `sym-lib-table`
* логирование процесса

Плагин **не обязан** заменять штатный импортёр.

---

## 4. Функциональные требования

### 4.1 Обработка библиотек

* Импорт **всех компонентов**, содержащихся в `.SchLib`
* Поддержка:

  * односекционных символов
  * многосекционных символов
* Сохранение относительного расположения графики и пинов

---

### 4.2 Именование

* Каждый символ должен иметь уникальное имя
* Правила именования должны быть:

  * конфигурируемыми
  * детерминированными

---

### 4.3 Логирование

* Лог:

  * успешно импортированных компонентов
  * пропущенных компонентов
  * предупреждений
  * ошибок нормализации

---

## 5. Нефункциональные требования

### 5.1 Поддерживаемость

* Код:

  * модульный
  * документированный
* Минимальная зависимость от внутренних API KiCad

---

### 5.2 Расширяемость

В перспективе:

* добавление экспорта:

  * в базу данных
  * в другие форматы
* интеграция с сервером компонентов

---

### 5.3 Производительность

* Импорт библиотеки до 1000 символов:

  * не более нескольких минут
* Batch-режим без UI-блокировок

---

## 6. Ограничения и допущения

* Не требуется:

  * 100% визуальная идентичность
* Допускается:

  * упрощение графики
  * изменение структуры при конфликте
* Импортёр **не обязан** сохранять Altium-специфичную параметрику

---

## 7. Этапы реализации

1. Анализ формата `.SchLib` (на основе образца)
2. Реализация парсера
3. Реализация внутренней модели
4. Реализация генератора `.kicad_sym`
5. Тестирование на предоставленных библиотеках
6. (Опционально) разработка плагина KiCad
7. Документация

---

## 8. Критерии приёмки

* Все компоненты из тестовой `.SchLib`:

  * присутствуют в `.kicad_sym`
* Библиотека:

  * корректно открывается в KiCad
  * символы доступны в Symbol Chooser
* Отсутствие:

  * критических ошибок
  * повреждённых символов

---

## 9. Комментарий без формальностей

Это **нормальное инженерное ТЗ**, а не “пофиксим импортёр”.
Ты:

* не ломаешь KiCad,
* не воюешь с апстримом,
* получаешь контролируемый, воспроизводимый процесс миграции.

Если хочешь, следующим шагом могу:

* разложить **структуру проекта (папки, модули)**,
* помочь описать **внутренний формат Symbol Model**,
* или показать, **где в исходниках KiCad лучше всего подсматривать логику**, чтобы не изобретать велосипед.

Это уже редкий случай, когда время, потраченное на “сделать правильно”, реально окупается.
