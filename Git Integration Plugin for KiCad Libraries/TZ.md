# Техническое задание

## Плагин интеграции Git в KiCad для управления библиотекой компонентов

---

## 1. Общая информация

**Наименование:**
Git Integration Plugin for KiCad Libraries

**Цель разработки:**
Обеспечить удобное выполнение операций Git (Pull, Commit, Push) непосредственно из интерфейса KiCad для централизованного хранения библиотек компонентов.

**Среда эксплуатации:**

* ОС: Linux Mint (Ubuntu-based)
* EDA: KiCad версии 7/8
* Git-сервер: Forgejo v14.0
* Подключение к серверу: SSH (ed25519)

---

## 2. Функциональные требования

### 2.1 Основной функционал

Плагин должен обеспечивать выполнение следующих операций:

1. **Git Pull**

   * Выполнение `git pull`
   * Отображение результата операции
   * Обработка конфликтов

2. **Git Commit**

   * Выполнение:

     * `git add .`
     * `git commit`
   * Диалог ввода сообщения коммита
   * Проверка наличия изменений перед коммитом

3. **Git Push**

   * Выполнение `git push`
   * Обработка ошибок (нет доступа, rejected и т.п.)

4. **Git Status**

   * Отображение:

     * изменённых файлов
     * неотслеживаемых файлов
     * текущей ветки

---

### 2.2 Дополнительный функционал

* Отображение текущей ветки
* Проверка наличия Git-репозитория в директории проекта
* Блокировка операций при отсутствии `.git`
* Отображение предупреждения при наличии merge-конфликтов
* Логирование операций в файл (например: `~/.kicad_git_plugin.log`)

---

## 3. Нефункциональные требования

### 3.1 Надёжность

* Плагин не должен блокировать работу KiCad при ошибке Git
* Все ошибки должны корректно перехватываться и выводиться пользователю

### 3.2 Производительность

* Время отклика операций не более 3 секунд при стандартном объёме библиотеки (< 500 файлов)

### 3.3 Безопасность

* Не хранить пароли
* Использовать системный SSH-агент
* Не передавать ключи напрямую

---

## 4. Архитектура решения

### 4.1 Тип плагина

Python Action Plugin для KiCad.

### 4.2 Взаимодействие с Git

Через системный вызов:

```python
subprocess.run(["git", "pull"], ...)
```

Без использования сторонних Python Git-библиотек.

### 4.3 Структура модулей

* `main.py` — регистрация плагина
* `git_service.py` — обёртка над вызовами Git
* `ui.py` — диалоги (commit message, лог ошибок)

---

## 5. Пользовательский интерфейс

### 5.1 Расположение

Меню:

```
Tools → External Plugins → Git Integration
```

### 5.2 Кнопки

* Pull
* Commit
* Push
* Status

### 5.3 Поведение UI

* Диалог подтверждения перед Push
* Поле ввода для commit message
* Отдельное окно вывода результата операций

---

## 6. Логика работы

### 6.1 Определение пути проекта

* Получение текущего пути через API KiCad
* Проверка наличия `.git`

### 6.2 Обработка конфликтов

* Если `git pull` возвращает код ошибки:

  * Вывести сообщение
  * Не выполнять дальнейшие операции

---

## 7. Ограничения

* Не реализуется:

  * визуализация графа веток
  * управление merge request
  * интерактивное разрешение конфликтов

* Плагин не заменяет полноценный Git-клиент

---

## 8. Этапы разработки

1. Прототип (Pull + Status)
2. Добавление Commit
3. Добавление Push
4. Обработка ошибок
5. UI улучшения
6. Тестирование на реальном репозитории библиотек

---

## 9. Критерии приёмки

* Pull выполняется корректно
* Commit создаётся с пользовательским сообщением
* Push проходит при наличии SSH-доступа
* Ошибки отображаются пользователю
* KiCad не зависает при сбое Git

---

## 10. Возможные будущие улучшения

* Автоматическая проверка DRC перед Commit
* Запрет Push в main
* Отображение diff внутри KiCad
* Интеграция с API Forgejo для MR

